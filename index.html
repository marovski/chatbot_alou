<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatbot Alou CVT - Registo de Reclama√ß√µes</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #1A2D5A 0%, #2C4A7C 100%); min-height: 100vh; display: flex; justify-content: center; align-items: center; padding: 20px; }
        .container { max-width: 900px; width: 100%; display: grid; grid-template-columns: 1fr 1fr; gap: 20px; background: white; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); overflow: hidden; }
        .chat-container { display: flex; flex-direction: column; height: 600px; }
        .chat-header { background: linear-gradient(135deg, #E8322A 0%, #C42A22 100%); color: white; padding: 20px; display: flex; align-items: center; gap: 15px; }
        .bot-avatar { width: 50px; height: 50px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; }
        .header-info h2 { font-size: 20px; margin-bottom: 3px; }
        .header-info p { font-size: 12px; opacity: 0.9; }
        .chat-messages { flex: 1; overflow-y: auto; padding: 20px; background: #F5F7FA; }
        .message { margin-bottom: 15px; display: flex; animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .message.bot { justify-content: flex-start; }
        .message.user { justify-content: flex-end; }
        .message-bubble { max-width: 75%; padding: 12px 16px; border-radius: 18px; word-wrap: break-word; }
        .message.bot .message-bubble { background: white; color: #1A2D5A; border-bottom-left-radius: 4px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .message.user .message-bubble { background: #00A9A5; color: white; border-bottom-right-radius: 4px; }
        .options { display: flex; flex-direction: column; gap: 8px; margin-top: 10px; }
        .option-btn { background: white; border: 2px solid #00A9A5; color: #00A9A5; padding: 10px 16px; border-radius: 10px; cursor: pointer; transition: all 0.3s ease; font-size: 14px; text-align: left; font-weight: 500; }
        .option-btn:hover:not(:disabled) { background: #00A9A5; color: white; transform: translateX(5px); }
        .option-btn:disabled { opacity: 0.6; cursor: not-allowed; border-color: #ccc; color: #666; }
        .chat-input-container { padding: 20px; background: white; border-top: 1px solid #E0E6ED; }
        .chat-input { display: flex; gap: 10px; }
        .chat-input input { flex: 1; padding: 12px 16px; border: 2px solid #E0E6ED; border-radius: 25px; font-size: 14px; outline: none; transition: border-color 0.3s; }
        .chat-input input:focus { border-color: #00A9A5; }
        .send-btn { background: #00A9A5; color: white; border: none; padding: 12px 24px; border-radius: 25px; cursor: pointer; font-weight: 600; transition: all 0.3s ease; }
        .send-btn:hover:not(:disabled) { background: #008A87; transform: scale(1.05); }
        .send-btn:disabled { background: #ccc; cursor: not-allowed; transform: scale(1); }
        .info-panel { background: #F5F7FA; padding: 30px; display: flex; flex-direction: column; gap: 20px; }
        .info-section { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .info-section h3 { color: #1A2D5A; margin-bottom: 12px; font-size: 16px; display: flex; align-items: center; gap: 8px; }
        .info-section p { color: #5A6A7E; font-size: 13px; line-height: 1.6; }
        .status-badge { display: inline-block; padding: 4px 12px; border-radius: 12px; font-size: 11px; font-weight: 600; margin-top: 8px; }
        .status-badge.active { background: #D5F4E6; color: #27AE60; }
        .status-badge.pending { background: #FFF4E0; color: #E67E22; }
        .status-badge.error { background: #FFE5E5; color: #D63031; }
        .kpi-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
        .kpi-card { background: #F5F7FA; padding: 12px; border-radius: 8px; text-align: center; }
        .kpi-value { font-size: 20px; font-weight: bold; color: #E8322A; }
        .kpi-label { font-size: 11px; color: #5A6A7E; margin-top: 4px; }
        .typing-indicator { display: none; padding: 10px 16px; background: white; border-radius: 18px; width: fit-content; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .typing-indicator.active { display: block; }
        .typing-indicator span { height: 8px; width: 8px; background: #00A9A5; border-radius: 50%; display: inline-block; margin: 0 2px; animation: typing 1.4s infinite; }
        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }
        @keyframes typing { 0%, 60%, 100% { transform: translateY(0); } 30% { transform: translateY(-10px); } }
        .protocol-card { background: linear-gradient(135deg, #00A9A5 0%, #008A87 100%); color: white; padding: 20px; border-radius: 12px; text-align: center; margin-top: 10px; }
        .protocol-number { font-size: 24px; font-weight: bold; letter-spacing: 2px; margin: 10px 0; }
        .restart-btn { background: #E8322A; color: white; border: none; padding: 12px 24px; border-radius: 25px; cursor: pointer; font-weight: 600; margin-top: 15px; width: 100%; transition: all 0.3s ease; }
        .restart-btn:hover { background: #C42A22; transform: scale(1.02); }
        @media (max-width: 768px) { .container { grid-template-columns: 1fr; } .info-panel { order: -1; padding: 20px; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="chat-container">
            <div class="chat-header">
                <div class="bot-avatar">ü§ñ</div>
                <div class="header-info">
                    <h2>Alou CVT</h2>
                    <p>Assistente Virtual de Reclama√ß√µes</p>
                </div>
            </div>
            
            <div class="chat-messages" id="chatMessages"></div>
            
            <div class="chat-input-container">
                <div class="chat-input">
                    <input type="text" id="userInput" placeholder="Digite sua mensagem..." disabled>
                    <button class="send-btn" id="sendBtn" disabled>Enviar</button>
                </div>
            </div>
        </div>
        
        <div class="info-panel">
            <div class="info-section">
                <h3>üìä Estado da Sess√£o</h3>
                <p id="sessionStatus">Aguardando identifica√ß√£o</p>
                <span class="status-badge pending" id="statusBadge">Em Progresso</span>
            </div>
            
            <div class="info-section">
                <h3>üìà KPIs do Sistema</h3>
                <div class="kpi-grid">
                    <div class="kpi-card">
                        <div class="kpi-value">72%</div>
                        <div class="kpi-label">Containment Rate</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-value">2.5min</div>
                        <div class="kpi-label">TMR M√©dio</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-value">43</div>
                        <div class="kpi-label">NPS</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-value">24/7</div>
                        <div class="kpi-label">Disponibilidade</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 1. STATE MANAGEMENT & SESSION PERSISTENCE (SAFE VERSION)
        let conversationState = {
            step: 'welcome',
            userData: {},
            existingComplaint: false,
            category: null,
            critical: false,
            protocol: null
        };

        const SESSION_KEY = 'alou_cvt_session';

        function saveSession() {
            try {
                const sessionData = {
                    state: conversationState,
                    html: document.getElementById('chatMessages').innerHTML,
                    statusText: document.getElementById('sessionStatus').textContent,
                    badgeClass: document.getElementById('statusBadge').className,
                    badgeText: document.getElementById('statusBadge').textContent
                };
                sessionStorage.setItem(SESSION_KEY, JSON.stringify(sessionData));
            } catch (error) {
                console.warn("Armazenamento de sess√£o bloqueado pelo navegador.");
            }
        }

        function clearSession() {
            try { sessionStorage.removeItem(SESSION_KEY); } catch (error) {}
            location.reload();
        }

        // 2. MOCK API SERVICES
        const mockAPI = {
            authenticate: async (type, value) => {
                return new Promise((resolve, reject) => {
                    setTimeout(() => {
                        if (Math.random() < 0.1) {
                            reject(new Error("Timeout na liga√ß√£o ao CRM (Siebel)."));
                        } else {
                            resolve({ name: "Cliente Registado", hasExisting: Math.random() < 0.3 });
                        }
                    }, 1500);
                });
            },
            createTicket: async (data) => {
                return new Promise((resolve, reject) => {
                    setTimeout(() => {
                        if (Math.random() < 0.1) {
                            reject(new Error("Falha ao gravar protocolo no sistema central."));
                        } else {
                            resolve(`RCL-${new Date().getFullYear()}-${String(Math.floor(Math.random() * 900000) + 100000)}`);
                        }
                    }, 2000);
                });
            }
        };

        // 3. NLP / KEYWORD ANALYSIS
        const analyzeCriticality = (text) => {
            const criticalKeywords = ['anacom', 'advogado', 'cancelar', 'tribunal', 'urgente', 'pol√≠cia', 'processo'];
            return criticalKeywords.some(keyword => text.toLowerCase().includes(keyword));
        };

        // UI Elements
        const chatMessages = document.getElementById('chatMessages');
        const userInput = document.getElementById('userInput');
        const sendBtn = document.getElementById('sendBtn');
        const sessionStatus = document.getElementById('sessionStatus');
        const statusBadge = document.getElementById('statusBadge');

        // Categories Configuration
        const categories = [
            { id: 'faturacao', label: 'üí≥ Fatura√ß√£o', desc: 'Problemas com faturas ou cobran√ßas' },
            { id: 'sinal', label: 'üì∂ Qualidade de Sinal', desc: 'Internet lenta ou sem conex√£o' },
            { id: 'tecnico', label: 'üîß Apoio T√©cnico', desc: 'Problemas com equipamentos' },
            { id: 'atendimento', label: 'üë§ Atendimento', desc: 'Quest√µes de servi√ßo ao cliente' },
            { id: 'outro', label: 'üìã Outro', desc: 'Outras situa√ß√µes' }
        ];

        // Utility Functions
        function scrollToBottom() { chatMessages.scrollTop = chatMessages.scrollHeight; }
        async function delay(ms) { return new Promise(resolve => setTimeout(resolve, ms)); }

        function updateSessionStatus(status, badge = 'pending') {
            sessionStatus.textContent = status;
            statusBadge.className = `status-badge ${badge}`;
            statusBadge.textContent = badge === 'active' ? 'Conclu√≠do' : (badge === 'error' ? 'Erro' : 'Em Progresso');
            saveSession();
        }

        function showTyping() {
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message bot';
            typingDiv.id = 'typing';
            typingDiv.innerHTML = `<div class="typing-indicator active"><span></span><span></span><span></span></div>`;
            chatMessages.appendChild(typingDiv);
            scrollToBottom();
        }

        function hideTyping() {
            const typing = document.getElementById('typing');
            if (typing) typing.remove();
        }

        function addMessage(text, isUser = false, options = null) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user' : 'bot'}`;
            
            const bubbleDiv = document.createElement('div');
            bubbleDiv.className = 'message-bubble';
            bubbleDiv.innerHTML = text;
            
            if (options) {
                const optionsDiv = document.createElement('div');
                optionsDiv.className = 'options';
                options.forEach(option => {
                    const btn = document.createElement('button');
                    btn.className = 'option-btn';
                    btn.innerHTML = option.label;
                    btn.setAttribute('onclick', `handleOptionClick('${option.id}', '${option.label.replace(/'/g, "\\'")}')`);
                    optionsDiv.appendChild(btn);
                });
                bubbleDiv.appendChild(optionsDiv);
            }
            
            messageDiv.appendChild(bubbleDiv);
            chatMessages.appendChild(messageDiv);
            scrollToBottom();
            saveSession();
        }

        // 4. CORE LOGIC & FLOW CONTROL
        window.handleOptionClick = async function(optionId, optionLabel) {
            document.querySelectorAll('.option-btn:not(:disabled)').forEach(btn => btn.disabled = true);
            addMessage(optionLabel, true);
            
            if (conversationState.step === 'identification') {
                conversationState.userData.identificationType = optionId;
                conversationState.step = 'awaiting_id_input';
                
                await delay(500);
                addMessage(`Por favor, digite o seu ${optionLabel.replace(/[^a-zA-Z√Ä-√ø\s]/g, '').trim()}:`);
                
                userInput.disabled = false;
                sendBtn.disabled = false;
                userInput.focus();
                saveSession();
            } 
            else if (conversationState.step === 'existing_complaint') {
                if (optionId === 'new') {
                    addMessage("Por favor, selecione a categoria da sua reclama√ß√£o:", false, categories.map(cat => ({
                        id: cat.id,
                        label: `${cat.label} - <small>${cat.desc}</small>`
                    })));
                    conversationState.step = 'category';
                    saveSession();
                } else if (optionId === 'exit') {
                    addMessage("Obrigado por utilizar o Alou CVT. At√© breve! üëã");
                    updateSessionStatus('Sess√£o encerrada', 'active');
                    showRestartButton();
                } else if (optionId === 'view') {
                    showTyping();
                    await delay(1500);
                    hideTyping();
                    
                    addMessage("A consultar os detalhes no sistema central...");
                    await delay(1000);
                    
                    addMessage(`
                        üìä <strong>Detalhes do Protocolo RCL-2025-001234</strong><br><br>
                        <strong>Fase Atual:</strong> An√°lise T√©cnica<br>
                        <strong>Data de Registo:</strong> ${new Date(Date.now() - 172800000).toLocaleDateString('pt-PT')}<br>
                        <strong>√öltima Atualiza√ß√£o:</strong> Aguarda verifica√ß√£o da equipa de infraestrutura externa.<br>
                        <strong>Prazo SLA:</strong> Faltam 2 dias √∫teis.
                    `);
                    
                    await delay(1500);
                    addMessage("Posso ajudar com mais alguma coisa?", false, [
                        { id: 'new', label: '‚ûï Registar nova reclama√ß√£o' },
                        { id: 'human', label: 'üë§ Falar com assistente sobre isto' },
                        { id: 'exit', label: '‚ùå Encerrar' }
                    ]);
                    
                    conversationState.step = 'after_view';
                    saveSession();
                }
            } 
            else if (conversationState.step === 'after_view') {
                if (optionId === 'new') {
                    addMessage("Por favor, selecione a categoria da sua reclama√ß√£o:", false, categories.map(cat => ({
                        id: cat.id,
                        label: `${cat.label} - <small>${cat.desc}</small>`
                    })));
                    conversationState.step = 'category';
                    saveSession();
                } else if (optionId === 'human') {
                    showTyping();
                    await delay(2000);
                    hideTyping();
                    addMessage("Vou transferi-lo para um assistente humano para analisar o estado deste processo em detalhe.");
                    updateSessionStatus('Transferido para assistente', 'active');
                    await delay(1000);
                    addMessage("üßë‚Äçüíº <strong>Assistente Maria:</strong> Ol√°! J√° tenho o seu processo aberto. Um momento por favor enquanto verifico os detalhes t√©cnicos...");
                    showRestartButton();
                } else if (optionId === 'exit') {
                    addMessage("Obrigado por utilizar o Alou CVT. At√© breve! üëã");
                    updateSessionStatus('Sess√£o encerrada', 'active');
                    showRestartButton();
                }
            }
            else if (conversationState.step === 'category') {
                conversationState.category = optionId;
                const selectedCat = categories.find(c => c.id === optionId);
                updateSessionStatus(`Categoria: ${selectedCat.label.split(' ')[1]}`);
                
                addMessage("Por favor, descreva detalhadamente o motivo da sua reclama√ß√£o:");
                conversationState.step = 'description';
                
                userInput.disabled = false;
                sendBtn.disabled = false;
                userInput.focus();
                saveSession();
            } 
            else if (conversationState.step === 'critical_decision') {
                if (optionId === 'human') {
                    showTyping();
                    await delay(2000);
                    hideTyping();
                    addMessage("Esta situa√ß√£o requer aten√ß√£o imediata. Vou transferi-lo para um assistente humano.");
                    updateSessionStatus('Transferido para assistente', 'active');
                    await delay(1000);
                    addMessage("üßë‚Äçüíº <strong>Assistente Maria:</strong> Ol√°! Vou ajud√°-lo pessoalmente com a sua situa√ß√£o. Um momento por favor...");
                    showRestartButton();
                } else {
                    await processNonCriticalComplaint();
                }
            } 
            else if (conversationState.step === 'satisfaction') {
                addMessage("Obrigado pelo seu feedback! A sua opini√£o ajuda-nos a melhorar.");
                updateSessionStatus('Sess√£o conclu√≠da', 'active');
                showRestartButton();
            }
        };

        async function handleUserMessage() {
            const text = userInput.value.trim();
            if (!text) return;
            
            addMessage(text, true);
            userInput.value = '';
            userInput.disabled = true;
            sendBtn.disabled = true;
            
            if (conversationState.step === 'awaiting_id_input') {
                if (text.length < 7) {
                    addMessage("‚ùå O formato introduzido parece incorreto. Por favor, tente novamente.");
                    userInput.disabled = false;
                    sendBtn.disabled = false;
                    userInput.focus();
                    return;
                }

                showTyping();
                try {
                    const userData = await mockAPI.authenticate(conversationState.userData.identificationType, text);
                    hideTyping();
                    
                    addMessage("Excelente! Verificando os seus dados...");
                    updateSessionStatus(`Cliente validado (${text})`);
                    
                    await delay(1000);
                    showTyping();
                    await delay(1500);
                    hideTyping();
                    
                    addMessage("A verificar o hist√≥rico no sistema...");
                    await delay(1000);
                    
                    if (userData.hasExisting) {
                        addMessage("Encontrei uma reclama√ß√£o j√° registada no seu nome:");
                        addMessage(`
                            <strong>Protocolo:</strong> RCL-2025-001234<br>
                            <strong>Categoria:</strong> Qualidade de Sinal<br>
                            <strong>Estado:</strong> Em An√°lise<br>
                            <strong>Prazo:</strong> 2 dias √∫teis restantes
                        `);
                        
                        await delay(1000);
                        addMessage("Como deseja proceder?", false, [
                            { id: 'view', label: 'üëÅÔ∏è Ver estado detalhado' },
                            { id: 'new', label: '‚ûï Registar nova reclama√ß√£o' },
                            { id: 'exit', label: '‚ùå Sair' }
                        ]);
                        conversationState.step = 'existing_complaint';
                    } else {
                        addMessage("N√£o encontrei reclama√ß√µes em aberto. Vamos registar uma nova.");
                        await delay(1000);
                        addMessage("Por favor, selecione a categoria da sua reclama√ß√£o:", false, categories.map(cat => ({
                            id: cat.id,
                            label: `${cat.label} - <small>${cat.desc}</small>`
                        })));
                        conversationState.step = 'category';
                    }
                    saveSession();
                    
                } catch (error) {
                    hideTyping();
                    updateSessionStatus('Erro de Autentica√ß√£o', 'error');
                    addMessage(`‚ö†Ô∏è <strong>Erro de Sistema:</strong> ${error.message}`);
                    addMessage("Por favor, tente inserir os dados novamente:");
                    
                    userInput.disabled = false;
                    sendBtn.disabled = false;
                    userInput.focus();
                }
            } 
            else if (conversationState.step === 'description') {
                conversationState.userData.description = text;
                
                showTyping();
                await delay(1500);
                hideTyping();
                
                addMessage("Analisando os detalhes fornecidos...");
                await delay(1000);
                
                conversationState.critical = analyzeCriticality(text);
                
                if (conversationState.critical) {
                    addMessage("‚ö†Ô∏è <strong>Aten√ß√£o:</strong> Detectei que esta situa√ß√£o envolve termos cr√≠ticos e pode requerer prioridade legal ou t√©cnica m√°xima.");
                    await delay(1000);
                    addMessage("Como deseja proceder?", false, [
                        { id: 'human', label: 'üë§ Transferir para assistente humano agora' },
                        { id: 'continue', label: '‚úÖ Manter registo autom√°tico normal' }
                    ]);
                    conversationState.step = 'critical_decision';
                    saveSession();
                } else {
                    await processNonCriticalComplaint();
                }
            }
        }

        async function processNonCriticalComplaint() {
            showTyping();
            await delay(1000);
            updateSessionStatus('A comunicar com o CRM...');
            
            try {
                const protocol = await mockAPI.createTicket(conversationState);
                hideTyping();
                
                conversationState.protocol = protocol;
                
                addMessage("Reclama√ß√£o registada com sucesso! Aqui est√° o seu protocolo:");
                addMessage(`
                    <div class="protocol-card">
                        <div>üìã PROTOCOLO DE RECLAMA√á√ÉO</div>
                        <div class="protocol-number">${protocol}</div>
                        <div style="font-size: 13px; opacity: 0.9; margin-top: 10px;">
                            Categoria: ${categories.find(c => c.id === conversationState.category).label.split(' ')[1]}<br>
                            Data: ${new Date().toLocaleDateString('pt-PT')}<br>
                            Prazo de resolu√ß√£o: 5 dias √∫teis
                        </div>
                    </div>
                `);
                
                updateSessionStatus('Reclama√ß√£o registada com sucesso', 'active');
                
                await delay(1500);
                addMessage("üìß Envi√°mos uma confirma√ß√£o para o seu email com os detalhes e prazos (SLA).");
                
                await delay(1500);
                addMessage("Como avalia a sua experi√™ncia com o Alou hoje?", false, [
                    { id: 'great', label: 'üòÑ Excelente' },
                    { id: 'good', label: 'üôÇ Bom' },
                    { id: 'ok', label: 'üòê Razo√°vel' },
                    { id: 'bad', label: 'üòû Insatisfeito' }
                ]);
                conversationState.step = 'satisfaction';
                saveSession();

            } catch (error) {
                hideTyping();
                updateSessionStatus('Erro no Registo', 'error');
                addMessage(`‚ö†Ô∏è <strong>Erro:</strong> ${error.message}`);
                addMessage("Os nossos sistemas est√£o temporariamente indispon√≠veis. A sua sess√£o foi guardada. Deseja tentar submeter novamente?", false, [
                    { id: 'retry', label: 'üîÑ Tentar Novamente' }
                ]);
                conversationState.step = 'retry_submission';
                window.handleOptionClick = async function(id) {
                    if(id === 'retry') {
                        document.querySelectorAll('.option-btn:not(:disabled)').forEach(btn => btn.disabled = true);
                        await processNonCriticalComplaint();
                    }
                };
                saveSession();
            }
        }

        function showRestartButton() {
            const restartDiv = document.createElement('div');
            restartDiv.className = 'message bot';
            restartDiv.innerHTML = `
                <div class="message-bubble">
                    <button class="restart-btn" onclick="clearSession()">
                        üîÑ Iniciar Nova Reclama√ß√£o
                    </button>
                </div>
            `;
            chatMessages.appendChild(restartDiv);
            scrollToBottom();
            saveSession();
        }

        // --- INITIALIZATION ---
        function initChatbot() {
            let savedSession = null;
            
            try {
                savedSession = sessionStorage.getItem(SESSION_KEY);
            } catch (error) {}
            
            if (savedSession) {
                try {
                    const data = JSON.parse(savedSession);
                    conversationState = data.state;
                    chatMessages.innerHTML = data.html;
                    sessionStatus.textContent = data.statusText;
                    statusBadge.className = data.badgeClass;
                    statusBadge.textContent = data.badgeText;
                    
                    addMessage("üîÑ <em>Sess√£o recuperada. Pode continuar de onde parou.</em>");
                    
                    if (['awaiting_id_input', 'description'].includes(conversationState.step)) {
                        userInput.disabled = false;
                        sendBtn.disabled = false;
                    }
                    scrollToBottom();
                    return;
                } catch (parseError) {
                    clearSession();
                }
            } 
            
            chatMessages.innerHTML = `
                <div class="message bot">
                    <div class="message-bubble">
                        Ol√°! Sou o Alou, o assistente virtual da CVTelecom. üëã<br><br>
                        Estou aqui para ajud√°-lo a registar a sua reclama√ß√£o de forma r√°pida e conveniente, 24/7.
                    </div>
                </div>
            `;
            
            setTimeout(() => {
                addMessage("Para come√ßar, preciso validar a sua identidade. Como deseja identificar-se?", false, [
                    { id: 'nif', label: 'üî¢ NIF' },
                    { id: 'conta', label: 'üì± N√∫mero da Conta' },
                    { id: 'telemovel', label: 'üìû N√∫mero de Telem√≥vel' }
                ]);
                conversationState.step = 'identification';
                saveSession();
            }, 1000);
        }

        // Event listeners
        sendBtn.addEventListener('click', handleUserMessage);
        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') handleUserMessage();
        });

        // Start
        initChatbot();
    </script>
</body>
</html>
